<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html class='no-js' lang='en'>
  <!-- <![endif] -->
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>MindMeld Voice Demo</title>
    <meta content='Voice nav' name='description'>
    <meta content='width=device-width' name='viewport'>
    <link rel="stylesheet" href="../../../dist/widgets/voiceNavigator/widget/widget.css" type="text/css">

    <style type="text/css">
      body {
        background-image: url(./img/rottentomatoes-bg.png);
        background-position: top center;
        background-repeat: no-repeat;
        background-color: #a9d5f7;
      }

      html, body {
        min-height: 100%; /* For bg image */
      }
    </style>
  </head>
  <body>
    <div class='main' role='main'>

      <a class='mm-voice-nav-init' href='#' id='toggle' style='position: absolute; top: 0; right: 0; color: red; padding: 5px 11px;'>Open Modal!</a>

    </div>
    <script>
        var MM = window.MM || {};
        MM.loader = MM.loader || {};
        MM.loader.rootURL = 'http://' + window.location.host + '/dist/';
        var VOICE_NAV_APPS = {
            'west-dev-d': {
                movieGenius: '2befc7c6ea69d12c0a34acb30c7152027cc37c78',
                techNews: '9a6721de8eabe1c378cc6e26468b9cff4a952dbd',
                recipeAssistant: 'b3acdcf114048e7e689503cb3a76cc8916f7b80d'
            },
            'west-dev-e': {
                movieGenius: 'ad666f13daeb5c36f6f2c3a11ec8b5d3d01467a0',
                techNews: '0bb356bc9b8507c5110174cd0a59d09dc5e19b89',
                recipeAssistant: '86c8eaaa345fe3c35527d8fe0d724cacff8411ff'
            },
            'west-prod-a': {
                movieGenius: 'f8587c112dbecc5d7d42d2c81cac6a0fc0671743',
                techNews: '53b2d92f34d89e1df16897cd7e1be5e23d990b79',
                recipeAssistant: '5e87d2fc46afcec7dd6680e675e92c61d60a67c3'
            }
        };
        var DEMO_ENVIRONMENT = 'west-dev-e';
    </script>
    <script>
        var MM = window.MM || {};
        MM.loader = MM.loader || {};
        MM.loader.rootURL = MM.loader.rootURL || 'https://developer.expectlabs.com/public/sdks/';
        MM.voiceNavigator = MM.voiceNavigator || {};
        MM.voiceNavigator.options = {
            appID: VOICE_NAV_APPS[DEMO_ENVIRONMENT]['movieGenius'],
///*
            cardLayout: rottenTomatoesCard,
            customCSSPath: './css/movieCards.css',
/*/// Comment out the cardLayout field if you would like to use card fields
            cardFields: [{
                key: 'director',
                label: 'Director',
                placeholder: 'Unknown'
            }, {
                key: 'pubdate',
                label: 'Release Date',
                placeholder: 'Unknown',
                format: 'date'
            }],
//*/
            cleanUrl: 'https://api-' + DEMO_ENVIRONMENT + '.expectlabs.com/',
            fayeClientUrl: 'https://push-' + DEMO_ENVIRONMENT + '.expectlabs.com:443/faye'
        };

      function rottenTomatoesCard(doc) {
        var html = '';
        var title = '<h2>' + doc.title + '</h2>';
        html += title;

        var description;
        if (typeof doc.description !== 'undefined') {
          description = doc.description.substr(0, 150) + (doc.description.length > 150 ? "&hellip;" : "");
        } else {
          description = "No description";
        }
        html += '<p>' + description + '</p>';

        var imageURL = false;
        if (typeof doc.image !== 'undefined') {
          if (typeof doc.image.url !== 'undefined') {
            imageURL = doc.image.url;
          } else if (typeof doc.image.thumburl !== 'undefined') {
            imageURL = doc.image.thumburl;
          }
        }
        if (imageURL) {
          html += '<p class="image notloaded"><img src="' + imageURL + '"></p>';
        }

        function getElementForKey(key, alignment) {
          var value = getFormattedValueForKey(key);

          var element = '<p class="align-' + alignment;
          if ((value === '')) { // empty value, use placeholder instead
            element += ' placeholder">' + getPlaceholderForKey(key);
          } else {
            element += '">'; // close initial p tag

            if (key === 'rating') {
              // add appropriate icon for rating
              var rating = parseInt(doc[key]);

              var icon = '<span class="rt-icon tiny ';
              icon += rating < 60 ? 'rotten' : 'fresh';
              icon += '"></span>';
              element += icon;


              var rating = '<span class="rt-rating">' + value + '</span>';
              element += rating;

            } else {
              // just add the text for others
              element += value;
            }
          }
          element += '</p>'; // close element

          return element;
        }

        function getFormattedValueForKey(key) {
          var value = doc[key];
          if (typeof value === 'undefined') {
            return '';
          }
          if (key === 'pubdate') {
            var date = new Date(value * 1000);
            return (date.getMonth() + 1) + '/' + date.getDay() + '/' + date.getFullYear();
          } else if (key === 'rating') {
            return value + '%';
          } else if (key === 'reviewcount') {
            var scales = ['', 'k', 'M'];
            var scale = scales.shift();
            while (value > 1000 && scales.length > 0) {
              scale = scales.shift(); // remove next scale
              value = parseInt(value) / 1000;
            }

            return '(' + Math.floor(value) + scale + ' reviews)';
          }
          return value;
        }

        function getPlaceholderForKey(key) {
          if (key === 'pubdate') {
            return 'No release date';
          } else if (key === 'genre') {
            return 'No genre';
          } else if (key === 'rating') {
            return 'No rating';
          } else if (key === 'reviewcount') {
            return 'No reviews';
          }
        }

        var rows = [{
          left: 'genre',
          right: 'pubdate'
        }, {
          left: 'rating',
          right: 'reviewcount'
        }];

        for (var i = 0, l = rows.length; i < l; i++) {
          var row = '<div class="metadata-row">';

          for (var alignment in rows[i]) {
            var elem = getElementForKey(rows[i][alignment], alignment);

            row += elem;
          }

          row += '<p class="clear-fix"></p>';
          row += '</div>';

          html += row;
        }

        return html;
      }
    </script>
    <script src="../../../dist/widgets/voiceNavigator/widget/widget.js"></script>
    <script>
        // Auto open modal
//        window.MM.voiceNavigator.showModal();
    </script>
  </body>
</html>

